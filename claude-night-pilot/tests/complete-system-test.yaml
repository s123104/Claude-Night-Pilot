# Claude Night Pilot - å®Œæ•´ç³»çµ±æ¸¬è©¦é©—è­‰æ–¹æ¡ˆ
# Material Design 3.0 + CLI/GUI æ•´åˆæ¸¬è©¦

test_suite:
  name: "Claude Night Pilot ç³»çµ±å®Œæ•´æ€§æ¸¬è©¦"
  version: "2.0.0"
  environment: "development"
  target_gui: "http://localhost:1420"
  target_cli: "/src-tauri/target/debug/cnp"

# ===== Phase 1: æ¸…é™¤ç¾æœ‰æ’ç¨‹ä»»å‹™ï¼ˆCLI å±¤ç´šåŸ·è¡Œï¼‰ =====
phase_1_cli_cleanup:
  description: "æ¸…ç†ç’°å¢ƒï¼Œæº–å‚™æ¸¬è©¦åŸºç¤"
  
  - task: "åˆ—å‡ºç¾æœ‰ä»»å‹™"
    command: "cd src-tauri && ./target/debug/cnp job list"
    expect:
      type: "success"
      output_format: "è¡¨æ ¼å¼åˆ—è¡¨"
      fields: ["ä»»å‹™ ID", "ç‹€æ…‹", "æ¨¡å¼"]
    description: "CLI - æª¢è¦–ç•¶å‰ç³»çµ±ä¸­çš„æ‰€æœ‰ä»»å‹™"

  - task: "åˆªé™¤æŒ‡å®šä»»å‹™"
    command: "./target/debug/cnp job delete 1"
    expect:
      type: "success"  
      output_contains: ["ä»»å‹™", "å·²æˆåŠŸåˆªé™¤"]
      status_icon: "âœ…"
    description: "CLI - æ¸¬è©¦ä»»å‹™åˆªé™¤åŠŸèƒ½ (Material DesignæˆåŠŸåœ–ç¤º)"

  - task: "é©—è­‰ä»»å‹™å·²åˆªé™¤"
    command: "./target/debug/cnp job list"
    expect:
      type: "success"
      not_contains: ["ä»»å‹™ ID: 1"]
    description: "CLI - ç¢ºèªä»»å‹™æˆåŠŸå¾ç³»çµ±ä¸­ç§»é™¤"

# ===== Phase 2: æ–°å¢æ’ç¨‹ä»»å‹™èˆ‡ Prompt ç®¡ç† =====
phase_2_task_creation:
  description: "å»ºç«‹æ–°çš„æ¸¬è©¦ä»»å‹™å’Œ Prompt"

  - task: "å»ºç«‹æ¸¬è©¦ Prompt"
    command: "./target/debug/cnp prompt create --title 'ç³»çµ±æ¸¬è©¦Prompt' --content '@docs/PROJECT_RULES.md è«‹é€²è¡Œç³»çµ±åˆ†æ' --tags 'system,test,material-design'"
    expect:
      type: "success"
      output_contains: ["Prompt å»ºç«‹æˆåŠŸ", "ID:"]
      extract_id: true
    description: "CLI - å»ºç«‹æ”¯æ´ Claude Code èªæ³•çš„æ¸¬è©¦ Prompt"

  - task: "åŸ·è¡ŒåŒæ­¥ä»»å‹™æ¸¬è©¦"
    command: "./target/debug/cnp job run ${PROMPT_ID} --mode sync"
    expect:
      type: "success_or_mock"
      output_contains: ["é–‹å§‹åŸ·è¡Œä»»å‹™", "åŸ·è¡ŒæˆåŠŸ"]
      material_icons: ["ğŸš€", "âœ…"]
    description: "CLI - æ¸¬è©¦ run_prompt_sync åŠŸèƒ½"

  - task: "å»ºç«‹æ’ç¨‹ä»»å‹™"
    command: "./target/debug/cnp run --prompt ${PROMPT_ID} --mode async --cron '*/5 * * * *'"
    expect: 
      type: "success"
      output_contains: ["æ’ç¨‹", "å»ºç«‹"]
      job_id_extracted: true
    description: "CLI - å»ºç«‹æ¯5åˆ†é˜åŸ·è¡Œçš„æ’ç¨‹ä»»å‹™"

# ===== Phase 3: GUI Material Design 3.0 é©—è­‰ =====
phase_3_gui_verification:
  description: "é©—è­‰ GUI æ­£ç¢ºé¡¯ç¤ºä»»å‹™ä¸¦ç¬¦åˆ Material Design è¦ç¯„"

  - task: "æª¢æŸ¥æ‡‰ç”¨è¼‰å…¥"
    action_type: "gui"
    selector: "#app-loader.md-elevation-level5"
    expect:
      visible: true
      contains_icon: "flight"
      icon_type: "material-symbols-rounded"
      animation: "fadeIn å­˜åœ¨"
    description: "GUI - Material Design è¼‰å…¥å‹•ç•«èˆ‡åœ–ç¤ºé©—è­‰"

  - task: "é©—è­‰é ‚éƒ¨æ‡‰ç”¨æ¬„"
    action_type: "gui"
    selector: ".md-top-app-bar.md-elevation-level2"
    expect:
      exists: true
      brand_icon: "flight (material-symbols-rounded)"
      action_buttons: 
        - icon: "light_mode"
          type: "material-symbols-outlined"
        - icon: "settings" 
          type: "material-symbols-outlined"
    description: "GUI - Material Design Top App Bar çµæ§‹é©—è­‰"

  - task: "æª¢æŸ¥æ–°æ’ç¨‹ä»»å‹™å¡ç‰‡é¡¯ç¤º"
    action_type: "gui"
    selector: "#job-list .job-card[data-cron='*/5 * * * *']"
    expect:
      exists: true
      material_design_card: true
      elevation: "md-elevation-level1"
      status_chip: ".md-status-chip"
    description: "GUI - å³æ™‚åŒæ­¥é¡¯ç¤ºæ–°å»ºç«‹çš„æ’ç¨‹ä»»å‹™"

# ===== Phase 4: å†·å»æ©Ÿåˆ¶èˆ‡ Material Icons æ¸¬è©¦ =====  
phase_4_cooldown_testing:
  description: "æ¸¬è©¦å†·å»ç‹€æ…‹é¡¯ç¤ºèˆ‡ Material Design å‹•ç•«"

  - task: "å†·å»ç‹€æ…‹åœ–ç¤ºé©—è­‰"
    action_type: "gui"
    selector: "#cooldown-status .status-icon"
    expect:
      icon_type: "material-symbols-rounded"
      valid_icons: ["check_circle", "timer", "schedule", "error"]
      not_emoji: true
    description: "GUI - ç¢ºä¿æ‰€æœ‰ç‹€æ…‹åœ–ç¤ºä½¿ç”¨ Material Design Icons"

  - task: "å†·å»å€’æ•¸å‹•ç•«æ¢æ¸¬è©¦"
    action_type: "gui"
    selector: ".progress-fill, .md-linear-progress .md-linear-progress-indicator"
    expect:
      exists_when: "cooling"
      animated: true
      width_changes: true
      duration: ">=1000ms"
    description: "GUI - Material Design é€²åº¦æ¢å‹•ç•«æ•ˆæœ"

  - task: "å‰©é¤˜æ™‚é–“æ ¼å¼é©—è­‰"
    action_type: "gui"
    selector: ".time-remaining .time"
    expect:
      format_regex: "\\d{1,2}:\\d{2}|æ­£å¸¸|æª¢æŸ¥ä¸­"
      updates_every: "5 seconds"
      font_family: "monospace"
    description: "GUI - æ™‚é–“é¡¯ç¤ºæ ¼å¼èˆ‡è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶"

  - task: "ç‹€æ…‹è½‰æ›å‹•ç•«"
    action_type: "gui_interaction"
    trigger: "cooldown_state_change"
    expect:
      transition_smooth: true
      duration: "var(--md-sys-motion-duration-medium2)"
      easing: "var(--md-sys-motion-easing-standard)"
    description: "GUI - Material Design ç‹€æ…‹è½‰æ›å‹•ç•«"

# ===== Phase 5: CLI éäº’å‹•å¼æŒ‡ä»¤åŠŸèƒ½æ¸¬è©¦ =====
phase_5_cli_comprehensive:
  description: "å…¨é¢æ¸¬è©¦ CLI å„é …åŠŸèƒ½"

  - task: "create_prompt åŠŸèƒ½"
    command: "./target/debug/cnp prompt create --title 'CLIåŠŸèƒ½æ¸¬è©¦' --content 'æ¸¬è©¦ CLI å»ºç«‹åŠŸèƒ½' --tags 'cli,functional'"
    expect:
      success_message: "Prompt å»ºç«‹æˆåŠŸ"
      returns_id: true
      material_feedback: "âœ…"
    description: "CLI - create_prompt æŒ‡ä»¤é©—è­‰"

  - task: "pause_job åŠŸèƒ½ (å¦‚å·²å¯¦ä½œ)"
    command: "./target/debug/cnp job cancel ${JOB_ID}"
    expect:
      type: "success_or_not_implemented"
      message_pattern: "(å·²æš«åœ|åŠŸèƒ½é–‹ç™¼ä¸­)"
    description: "CLI - pause_job æš«åœä»»å‹™åŠŸèƒ½"

  - task: "delete_job åŠŸèƒ½"
    command: "./target/debug/cnp job delete ${JOB_ID}"
    expect:
      success_message: "å·²æˆåŠŸåˆªé™¤"
      material_icon: "âœ…"
      database_updated: true
    description: "CLI - delete_job åˆªé™¤ä»»å‹™åŠŸèƒ½"

  - task: "ç³»çµ±ç‹€æ…‹æª¢æŸ¥"
    command: "./target/debug/cnp cooldown"
    expect:
      type: "success"
      status_info: true
      material_compatible: true
    description: "CLI - ç³»çµ±å†·å»ç‹€æ…‹æª¢æŸ¥"

# ===== Phase 6: E2E æ¸¬è©¦è…³æœ¬åŸ·è¡Œ =====
phase_6_e2e_automation:
  description: "è‡ªå‹•åŒ–ç«¯åˆ°ç«¯æ¸¬è©¦æµç¨‹"

  - task: "åŸ·è¡Œ Playwright æ¸¬è©¦"
    command: "npm test -- tests/material-design-e2e.spec.js"
    expect:
      all_tests_pass: true
      material_design_compliance: "100%"
      no_emoji_found: true
    description: "E2E - è‡ªå‹•åŒ–æ¸¬è©¦æ‰€æœ‰ GUI æµç¨‹"

  - task: "éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦"
    test_viewports:
      - {width: 1200, height: 800, name: "desktop"}
      - {width: 768, height: 1024, name: "tablet"} 
      - {width: 375, height: 667, name: "mobile"}
    expect:
      all_layouts_functional: true
      material_components_responsive: true
      icons_visible_all_sizes: true
    description: "E2E - è·¨è£ç½®éŸ¿æ‡‰å¼è¨­è¨ˆé©—è­‰"

# ===== Phase 7: Material Design 3.0 Icons å…¨é¢æª¢æŸ¥ =====
phase_7_icon_verification:
  description: "ç¢ºä¿æ‰€æœ‰ emoji å·²æ›¿æ›ç‚º Material Design Icons"

  - task: "æƒæ HTML ä¸­çš„ emoji"
    action_type: "code_scan"
    files: ["src/index.html", "src/main.js"]
    search_pattern: "[ğŸŒ™âœˆï¸ğŸ“‹ğŸ¯ğŸ”§ğŸ“±âš¡ğŸš€âœ…âŒğŸ’¡ğŸ”„ğŸ“Š]"
    expect:
      matches_found: 0
      replacement_complete: true
    description: "ä»£ç¢¼æƒæ - ç¢ºèªç„¡æ®˜ç•™ emoji"

  - task: "Material Icons CDN è¼‰å…¥é©—è­‰" 
    action_type: "gui"
    selector: "link[href*='material-symbols']"
    expect:
      cdn_loaded: true
      font_families: ["Material+Symbols+Rounded", "Material+Symbols+Outlined"]
      status: "loaded"
    description: "GUI - Material Design Icons å­—é«”è¼‰å…¥ç‹€æ…‹"

  - task: "åœ–ç¤ºèªæ„æ­£ç¢ºæ€§æª¢æŸ¥"
    action_type: "gui_validation"
    icon_mappings:
      success_states: "check_circle"
      error_states: "error"  
      timer_states: "timer"
      schedule_states: "schedule"
      loading_states: "hourglass_empty"
    expect:
      semantic_accuracy: "100%"
      consistent_usage: true
    description: "GUI - Material Icons èªæ„ä½¿ç”¨æ­£ç¢ºæ€§"

# ===== æ¸¬è©¦åŸ·è¡ŒæŒ‡å¼• =====
execution_instructions:
  pre_requirements:
    - "Tauri æ‡‰ç”¨ç¨‹å¼é‹è¡Œæ–¼ http://localhost:1420"
    - "CLI å·¥å…·å·²ç·¨è­¯: cargo build --bin cnp"
    - "è³‡æ–™åº«å¯è®€å¯«: claude-pilot.db"
    - "Node.js ç’°å¢ƒæ­£å¸¸: npm èˆ‡ Playwright"

  execution_order:
    1. "åŸ·è¡Œ Phase 1-2: CLI åŸºç¤åŠŸèƒ½æ¸¬è©¦"
    2. "å•Ÿå‹• GUI æ‡‰ç”¨ç¨‹å¼"
    3. "åŸ·è¡Œ Phase 3-4: GUI Material Design é©—è­‰"
    4. "åŸ·è¡Œ Phase 5: CLI é€²éšåŠŸèƒ½æ¸¬è©¦"
    5. "åŸ·è¡Œ Phase 6: E2E è‡ªå‹•åŒ–æ¸¬è©¦"
    6. "åŸ·è¡Œ Phase 7: æœ€çµ‚é©—è­‰"

  success_criteria:
    cli_functionality: ">=90% é€šé"
    gui_material_design: "100% åˆè¦"
    icon_replacement: "100% å®Œæˆ"
    e2e_tests: ">=95% é€šé"
    performance: "è¼‰å…¥ <3s, éŸ¿æ‡‰ <100ms"

# ===== é æœŸæ¸¬è©¦çµæœ =====
expected_outcomes:
  âœ… CLI åŠŸèƒ½:
    - prompt_management: "create, list, delete æŒ‡ä»¤æ­£å¸¸"
    - job_management: "create, run, delete æŒ‡ä»¤æ­£å¸¸"  
    - system_integration: "cooldown, status æª¢æŸ¥æ­£å¸¸"

  âœ… Material Design GUI:
    - component_compliance: "æ‰€æœ‰çµ„ä»¶ç¬¦åˆ MD3 è¦ç¯„"
    - icon_system: "100% Material Design Icons"
    - animation_system: "æµæš¢çš„ç‹€æ…‹è½‰æ›å‹•ç•«"
    - elevation_system: "æ­£ç¢ºçš„é™°å½±å±¤æ¬¡"

  âœ… å³æ™‚åŒæ­¥:
    - cli_to_gui: "CLI æ“ä½œç«‹å³åæ˜ åœ¨ GUI"
    - status_updates: "å†·å»ç‹€æ…‹å³æ™‚æ›´æ–°"
    - progress_animation: "é€²åº¦æ¢å‹•ç•«æµæš¢"

  âœ… å†·å»æ©Ÿåˆ¶:
    - status_display: "æ¸…æ™°çš„è¦–è¦ºç‹€æ…‹æŒ‡ç¤º"
    - countdown_precision: "ç²¾ç¢ºçš„å€’æ•¸è¨ˆæ™‚"
    - recovery_animation: "æ¢å¾©ç‹€æ…‹å‹•ç•«æ•ˆæœ"

# ===== æ•…éšœæ’é™¤æŒ‡å— =====
troubleshooting:
  common_issues:
    - issue: "GUI è¼‰å…¥å¤±æ•—"
      solution: "æª¢æŸ¥ CooldownManager.init() æ˜¯å¦æ­£ç¢ºå¯¦ä½œ"
      
    - issue: "CLI å‘½ä»¤ä¸å­˜åœ¨"
      solution: "ç¢ºèªå·²ç·¨è­¯æœ€æ–°ç‰ˆæœ¬: cargo build --bin cnp"
      
    - issue: "Material Icons æœªè¼‰å…¥"
      solution: "æª¢æŸ¥ç¶²è·¯é€£æ¥èˆ‡ CDN è¼‰å…¥ç‹€æ…‹"
      
    - issue: "è³‡æ–™åº«éŒ¯èª¤"
      solution: "ç¢ºèª claude-pilot.db æª”æ¡ˆå­˜åœ¨ä¸”å¯å¯«å…¥"

# ===== æ¸¬è©¦å ±å‘Šæ ¼å¼ =====
reporting:
  format: "YAML + JSON çµåˆ"
  include_screenshots: true
  performance_metrics: true
  material_design_compliance_score: true
  automated_test_coverage: true