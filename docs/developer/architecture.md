# Claude Night Pilot - ç³»çµ±æ¶æ§‹æ–‡æª”

**æœ€å¾Œæ›´æ–°**: 2025-07-24T23:23:43+08:00  
**æ¶æ§‹ç‰ˆæœ¬**: v1.0.0  
**æŠ€è¡“æ£§**: Tauri 2 + Rust + SQLite + htmx  
**åƒè€ƒæ¨™æº–**: [Context7:tauri-apps/tauri-docs:2025-07-24T23:23:43+08:00]

## ğŸ—ï¸ æ•´é«”æ¶æ§‹æ¦‚è¦½

Claude Night Pilot æ¡ç”¨ç¾ä»£åŒ–çš„è·¨å¹³å°æ¡Œé¢æ‡‰ç”¨æ¶æ§‹ï¼ŒåŸºæ–¼ Tauri 2 æ¡†æ¶å¯¦ç¾å‰å¾Œç«¯åˆ†é›¢ï¼Œä¸¦æ•´åˆå››å¤§æ ¸å¿ƒæ¨¡çµ„æä¾›å®Œæ•´çš„ Claude CLI ç®¡ç†è§£æ±ºæ–¹æ¡ˆã€‚

### æ¶æ§‹ç‰¹é»
- **è·¨å¹³å°æ”¯æ´**: macOS, Windows, Linux
- **è¨˜æ†¶é«”å®‰å…¨**: Rust å¾Œç«¯ç¢ºä¿ç³»çµ±ç©©å®šæ€§
- **è¼•é‡é«˜æ•ˆ**: åŸç”Ÿæ€§èƒ½ï¼Œä½è³‡æºä½”ç”¨
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: é«˜å…§èšä½è€¦åˆçš„çµ„ä»¶æ¶æ§‹
- **ä¼æ¥­ç´šå®‰å…¨**: å¤šå±¤å®‰å…¨æª¢æŸ¥èˆ‡å¯©è¨ˆæ©Ÿåˆ¶

## ğŸ”§ æŠ€è¡“æ£§è©³ç´°

### å‰ç«¯å±¤ (Frontend)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Web UI Layer             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ htmx - ç¾ä»£åŒ–äº’å‹•æ¡†æ¶              â”‚
â”‚ â€¢ HTML5/CSS3 - æ¨™æº–åŒ–ä»‹é¢           â”‚
â”‚ â€¢ Material Design 3.0 - è¨­è¨ˆç³»çµ±    â”‚
â”‚ â€¢ JavaScript ES6+ - å®¢æˆ¶ç«¯é‚è¼¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šè¨Šå±¤ (IPC Communication)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Tauri Command Layer         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ @tauri-apps/api - å‰ç«¯ API        â”‚
â”‚ â€¢ JSON-RPC - çµæ§‹åŒ–é€šè¨Šå”è­°         â”‚
â”‚ â€¢ Event System - äº‹ä»¶é©…å‹•é€šçŸ¥       â”‚
â”‚ â€¢ Capability System - æ¬Šé™æ§åˆ¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾Œç«¯å±¤ (Backend)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Rust Core Layer           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Tauri 2 Runtime - æ‡‰ç”¨æ¡†æ¶        â”‚
â”‚ â€¢ Tokio - ç•°æ­¥é‹è¡Œæ™‚                â”‚
â”‚ â€¢ SQLx - å‹åˆ¥å®‰å…¨è³‡æ–™åº«æ“ä½œ          â”‚
â”‚ â€¢ Serde - åºåˆ—åŒ–/ååºåˆ—åŒ–           â”‚
â”‚ â€¢ Chrono - æ™‚é–“è™•ç†èˆ‡æ™‚å€æ”¯æ´        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¢ å››å¤§æ ¸å¿ƒæ¨¡çµ„æ¶æ§‹

### æ¨¡çµ„æ•´åˆé—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Smart Scheduler â”‚â—„â”€â”€â–ºâ”‚ Adaptive Monitor â”‚â—„â”€â”€â–ºâ”‚ Usage Tracker   â”‚
â”‚   (æ™ºèƒ½æ’ç¨‹)      â”‚    â”‚   (è‡ªé©æ‡‰ç›£æ§)    â”‚    â”‚  (ä½¿ç”¨é‡è¿½è¹¤)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                        â”‚                        â”‚
          â”‚                        â”‚                        â”‚
          â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Executor (å®‰å…¨åŸ·è¡Œç³»çµ±)                        â”‚
â”‚              â”œâ”€ ExecutionOptions                                â”‚
â”‚              â”œâ”€ SecurityCheck                                   â”‚
â”‚              â”œâ”€ AuditLog                                        â”‚
â”‚              â””â”€ ClaudeExecutor                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SQLite Database                            â”‚
â”‚              â”œâ”€ usage_records                                   â”‚
â”‚              â”œâ”€ execution_audits                                â”‚
â”‚              â”œâ”€ scheduled_tasks                                 â”‚
â”‚              â””â”€ monitoring_events                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Usage Tracker (ä½¿ç”¨é‡è¿½è¹¤æ¨¡çµ„)
**æª”æ¡ˆ**: `src-tauri/src/usage_tracker.rs` (~400 è¡Œ)

**è·è²¬**:
- Claude ä½¿ç”¨é‡å³æ™‚ç›£æ§
- å¤šå‘½ä»¤å›é€€æ©Ÿåˆ¶ (ccusage â†’ npx â†’ bunx)
- æ™ºèƒ½å¿«å–èˆ‡æ­·å²è¨˜éŒ„
- ä½¿ç”¨é‡é æ¸¬èˆ‡åˆ†æ

**æ ¸å¿ƒ API**:
```rust
#[tauri::command] get_usage_status() -> UsageInfo
#[tauri::command] get_usage_history(hours: u32) -> Vec<UsageRecord>
#[tauri::command] invalidate_usage_cache()
```

### 2. Executor (å®‰å…¨åŸ·è¡Œç³»çµ±)
**æª”æ¡ˆ**: `src-tauri/src/executor.rs` (~500 è¡Œ)

**è·è²¬**:
- Claude CLI å®‰å…¨åŸ·è¡Œ
- å¤šå±¤å®‰å…¨æª¢æŸ¥æ©Ÿåˆ¶
- å®Œæ•´æ“ä½œå¯©è¨ˆè¨˜éŒ„
- æ™ºèƒ½é‡è©¦èˆ‡éŒ¯èª¤è™•ç†

**æ ¸å¿ƒ API**:
```rust
#[tauri::command] execute_claude_with_options(prompt, options) -> String
#[tauri::command] execute_claude_safe(prompt) -> String
#[tauri::command] validate_execution_options(options) -> SecurityCheckResult
```

### 3. Adaptive Monitor (è‡ªé©æ‡‰ç›£æ§ç³»çµ±)
**æª”æ¡ˆ**: `src-tauri/src/adaptive_monitor.rs` (~600 è¡Œ)

**è·è²¬**:
- å…­å±¤å‹•æ…‹ç›£æ§é »ç‡èª¿æ•´
- äº‹ä»¶é©…å‹•ç‹€æ…‹é€šçŸ¥
- è³‡æºä½¿ç”¨å„ªåŒ–
- ç›£æ§æ•¸æ“šçµ±è¨ˆåˆ†æ

**æ ¸å¿ƒ API**:
```rust
#[tauri::command] get_monitoring_status() -> MonitoringStatus
#[tauri::command] trigger_monitoring_check()
#[tauri::command] update_monitoring_config(config)
```

### 4. Smart Scheduler (æ™ºèƒ½æ’ç¨‹ç³»çµ±)
**æª”æ¡ˆ**: `src-tauri/src/smart_scheduler.rs` (~550 è¡Œ)

**è·è²¬**:
- æ™‚å€æ„ŸçŸ¥çš„æ™ºèƒ½æ’ç¨‹
- 5å°æ™‚å¡Šä¿è­·æ©Ÿåˆ¶
- å·¥ä½œæ™‚é–“æœ€ä½³åŒ–
- æ’ç¨‹æ±ºç­–å¼•æ“

**æ ¸å¿ƒ API**:
```rust
#[tauri::command] make_scheduling_decision(...) -> SchedulingDecision
#[tauri::command] schedule_smart_task(...) -> String
#[tauri::command] get_scheduled_tasks() -> Vec<ScheduledTask>
```

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹

### SQLite è³‡æ–™åº«è¨­è¨ˆ

```sql
-- ä½¿ç”¨é‡è¨˜éŒ„è¡¨
CREATE TABLE usage_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    total_usage_usd REAL,
    remaining_time_minutes INTEGER,
    status TEXT,
    metadata TEXT  -- JSONæ ¼å¼çš„é¡å¤–è³‡è¨Š
);

-- åŸ·è¡Œå¯©è¨ˆè¡¨
CREATE TABLE execution_audits (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    prompt_hash TEXT,  -- SHA256é›œæ¹Š
    execution_options TEXT,  -- JSONæ ¼å¼
    risk_level TEXT,  -- Low/Medium/High/Critical
    result_summary TEXT,
    duration_ms INTEGER
);

-- æ’ç¨‹ä»»å‹™è¡¨
CREATE TABLE scheduled_tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_name TEXT,
    prompt TEXT,
    schedule_expression TEXT,  -- Cronæ ¼å¼
    next_execution DATETIME,
    status TEXT,  -- pending/running/completed/failed
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç›£æ§äº‹ä»¶è¡¨
CREATE TABLE monitoring_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    event_type TEXT,  -- status_change/threshold_crossed/error
    old_value TEXT,
    new_value TEXT,
    metadata TEXT  -- JSONæ ¼å¼
);
```

## ğŸ” å®‰å…¨æ¶æ§‹

### å¤šå±¤å®‰å…¨æª¢æŸ¥æ©Ÿåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Security Layers           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Environment Authorization       â”‚
â”‚ 2. Working Directory Validation    â”‚
â”‚ 3. Dangerous Mode Detection        â”‚
â”‚ 4. Command Safety Verification     â”‚
â”‚ 5. Execution Audit Logging         â”‚
â”‚ 6. Result Sanitization            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¬Šé™ç®¡ç†
- **æœ€å°æ¬Šé™åŸå‰‡**: é è¨­æ‹’çµ•æ‰€æœ‰å±éšªæ“ä½œ
- **æ˜ç¢ºæˆæ¬Š**: é€é `--dangerously-skip-permissions` æ˜ç¢ºæˆæ¬Š
- **å®Œæ•´å¯©è¨ˆ**: æ‰€æœ‰æ“ä½œè¨˜éŒ„ SHA256 é›œæ¹Šèˆ‡é¢¨éšªç­‰ç´š
- **å³æ™‚ç›£æ§**: å±éšªæ“ä½œå³æ™‚è­¦å‘Šèˆ‡æ””æˆª

## ğŸ“¡ äº‹ä»¶é©…å‹•æ¶æ§‹

### äº‹ä»¶æµç¨‹åœ–

```
Frontend Event â”€â”€â–º Tauri Command â”€â”€â–º Rust Handler
       â”‚                                     â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€ JSON Response â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                     â”‚
       â”‚           Background Tasks          â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€ Event Emission â—„â”€â”€â”€â”€â”€â”€â”€ Tokio Spawn
```

### ä¸»è¦äº‹ä»¶é¡å‹
- **usage_update**: ä½¿ç”¨é‡è®Šæ›´é€šçŸ¥
- **monitoring_status_change**: ç›£æ§ç‹€æ…‹è®Šæ›´
- **task_scheduled**: ä»»å‹™æ’ç¨‹é€šçŸ¥
- **security_alert**: å®‰å…¨è­¦å‘Šäº‹ä»¶
- **system_ready**: ç³»çµ±å°±ç·’é€šçŸ¥

## ğŸš€ éƒ¨ç½²æ¶æ§‹

### ç›®éŒ„çµæ§‹
```
tauri-app/
â”œâ”€â”€ src/                      # å‰ç«¯æºç¢¼
â”‚   â”œâ”€â”€ index.html           # ä¸»é é¢
â”‚   â”œâ”€â”€ main.js             # æ‡‰ç”¨é‚è¼¯
â”‚   â””â”€â”€ styles.css          # æ¨£å¼æ–‡ä»¶
â”œâ”€â”€ src-tauri/              # å¾Œç«¯æºç¢¼
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.rs         # æ‡‰ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ lib.rs          # æ¨¡çµ„åŒ¯å‡º
â”‚   â”‚   â”œâ”€â”€ usage_tracker.rs
â”‚   â”‚   â”œâ”€â”€ executor.rs
â”‚   â”‚   â”œâ”€â”€ adaptive_monitor.rs
â”‚   â”‚   â””â”€â”€ smart_scheduler.rs
â”‚   â”œâ”€â”€ Cargo.toml          # Rust ä¾è³´
â”‚   â”œâ”€â”€ tauri.conf.json     # Tauri é…ç½®
â”‚   â””â”€â”€ capabilities/       # æ¬Šé™å®šç¾©
â”œâ”€â”€ package.json            # Node.js é…ç½®
â””â”€â”€ README.md              # å°ˆæ¡ˆèªªæ˜
```

### å»ºç½®æµç¨‹
1. **å‰ç«¯å»ºç½®**: ç·¨è­¯ HTML/CSS/JS è³‡æº
2. **å¾Œç«¯ç·¨è­¯**: Rust ä»£ç¢¼ç·¨è­¯ç‚ºåŸç”ŸäºŒé€²åˆ¶æª”æ¡ˆ
3. **è³‡æºæ‰“åŒ…**: æ•´åˆå‰å¾Œç«¯ç‚ºå–®ä¸€å¯åŸ·è¡Œæª”æ¡ˆ
4. **å¹³å°æ‰“åŒ…**: ç”Ÿæˆå¹³å°ç‰¹å®šçš„å®‰è£åŒ…

## ğŸ“ˆ æ€§èƒ½æ¶æ§‹

### æ€§èƒ½æŒ‡æ¨™
- **å•Ÿå‹•æ™‚é–“**: < 300ms (Release ç‰ˆæœ¬)
- **è¨˜æ†¶é«”ä½¿ç”¨**: < 50MB (ç³»çµ±é–’ç½®)
- **API éŸ¿æ‡‰**: < 50ms (æœ¬åœ° SQL æŸ¥è©¢)
- **GUI äº’å‹•**: < 100ms (ç”¨æˆ¶æ“ä½œéŸ¿æ‡‰)

### å„ªåŒ–ç­–ç•¥
- **æ™ºèƒ½å¿«å–**: 30ç§’ä½¿ç”¨é‡å¿«å–é¿å…é‡è¤‡æŸ¥è©¢
- **ç•°æ­¥è™•ç†**: Tokio éåŒæ­¥é‹è¡Œæ™‚æœ€å¤§åŒ–ä¸¦ç™¼
- **è³‡æºæ± åŒ–**: è³‡æ–™åº«é€£æ¥æ± ç®¡ç†
- **äº‹ä»¶é©…å‹•**: é¿å…è¼ªè©¢å¼çš„è³‡æºæµªè²»

## ğŸ”„ æ“´å±•æ¶æ§‹

### æ¨¡çµ„åŒ–è¨­è¨ˆåŸå‰‡
- **é«˜å…§èš**: æ¯å€‹æ¨¡çµ„è·è²¬å–®ä¸€ä¸”å®Œæ•´
- **ä½è€¦åˆ**: æ¨¡çµ„é–“é€éå®šç¾©è‰¯å¥½çš„ä»‹é¢é€šè¨Š
- **å¯æ’æ‹”**: æ”¯æ´æ¨¡çµ„çš„å‹•æ…‹è¼‰å…¥èˆ‡å¸è¼‰
- **å¯é…ç½®**: æ‰€æœ‰è¡Œç‚ºé€éé…ç½®æª”æ¡ˆèª¿æ•´

### æœªä¾†æ“´å±•æ–¹å‘
- **æ’ä»¶ç³»çµ±**: ç¬¬ä¸‰æ–¹æ¨¡çµ„æ•´åˆæ©Ÿåˆ¶
- **åˆ†æ•£å¼æ¶æ§‹**: æ”¯æ´å¤šå¯¦ä¾‹å”ä½œ
- **é›²ç«¯æ•´åˆ**: æ•¸æ“šåŒæ­¥èˆ‡å‚™ä»½æ©Ÿåˆ¶
- **AI è¼”åŠ©**: æ™ºèƒ½åŒ–æ±ºç­–èˆ‡å»ºè­°ç³»çµ±

---

**ç¶­è­·è€…**: Claude Night Pilot é–‹ç™¼åœ˜éšŠ  
**æŠ€è¡“æ¨™æº–**: åŸºæ–¼ Tauri å®˜æ–¹æ–‡æª”æœ€ä½³å¯¦è¸  
**æ›´æ–°é€±æœŸ**: éš¨æŠ€è¡“æ£§ç‰ˆæœ¬æ›´æ–°åŒæ­¥ç¶­è­· 